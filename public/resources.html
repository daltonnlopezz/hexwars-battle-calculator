<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HEX Wars Resource Calculator</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Logo -->
    <div class="logo-container">
        <img src="static/images/logo.jpg" alt="HEX Wars Logo" class="logo-image" />
    </div>

    <h1>HEX WARS RESOURCE CALCULATOR</h1>

    <!-- Navigation Card -->
    <div class="nav-card">
        <a href="index.html" class="nav-btn battle-btn">
            <span class="btn-icon">‚öîÔ∏è</span>
            <span class="btn-text">Battle Calculator</span>
        </a>
        <a href="factions.html" class="nav-btn factions-btn">
            <span class="btn-icon">üìã</span>
            <span class="btn-text">Faction Details</span>
        </a>
        <a href="login.html" class="nav-btn login-btn">
            <span class="btn-icon">üë§</span>
            <span class="btn-text">Character Creation</span>
        </a>
        <a href="character.html" class="nav-btn character-btn">
            <span class="btn-icon">‚öîÔ∏è</span>
            <span class="btn-text">My Characters</span>
        </a>
    </div>

    <!-- Round Counter and Faction Selection Section -->
    <div class="round-faction-section">
        <div class="round-counter-card">
            <div class="round-counter-header">
                <span class="round-counter-icon">üéØ</span>
                <h3>Current Round</h3>
            </div>
            <div class="round-counter-controls">
                <button class="round-btn" onclick="decreaseRound()" title="Previous Round">
                    <span>‚àí</span>
                </button>
                <div class="round-display">
                    <input type="number" id="currentRound" min="1" value="1" onchange="updateRound()">
                    <span class="round-label">Round</span>
                </div>
                <button class="round-btn" onclick="increaseRound()" title="Next Round">
                    <span>+</span>
                </button>
            </div>
        </div>
        
        <div class="faction-selection-card">
            <div class="faction-selection-header">
                <span class="faction-selection-icon">‚öîÔ∏è</span>
                <h3>Faction Selection</h3>
            </div>
            <div class="faction-selection-controls">
                <div class="faction-selector">
                    <label for="recruitmentFaction">Faction:</label>
                    <select id="recruitmentFaction" onchange="updateRecruitmentUnits()">
                        <option value="Empire">Empire</option>
                        <option value="Raiders">Raiders</option>
                        <option value="HORDE">HORDE</option>
                        <option value="Ironborne">Ironborne</option>
                        <option value="Vanguard">Vanguard</option>
                        <option value="Damned">Damned</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- Resource Pool Section -->
    <div class="resource-pool-section">
        <div class="army-card resources-card">
            <div class="card-header resources-header">
                <span class="header-icon">üíé</span>
                <h2>Resource Pool</h2>
            </div>
            <div class="card-content">
                <div class="resource-pool-grid">
                    <div class="resource-pool-item">
                        <span class="resource-icon">üçñ</span>
                        <label for="poolFood">Food:</label>
                        <input type="number" id="poolFood" min="0" value="0" placeholder="0">
                    </div>
                    <div class="resource-pool-item">
                        <span class="resource-icon">üí∞</span>
                        <label for="poolGold">Gold:</label>
                        <input type="number" id="poolGold" min="0" value="0" placeholder="0">
                    </div>
                    <div class="resource-pool-item">
                        <span class="resource-icon">‚öíÔ∏è</span>
                        <label for="poolIron">Iron:</label>
                        <input type="number" id="poolIron" min="0" value="0" placeholder="0">
                    </div>
                    <div class="resource-pool-item">
                        <span class="resource-icon">üì¶</span>
                        <label for="poolOther">Other:</label>
                        <input type="number" id="poolOther" min="0" value="0" placeholder="0">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Resource Calculator Container -->
    <div class="calculator-container">
        <!-- KINGDOM MANAGEMENT -->
        <div class="army-card kingdom-card">
            <div class="card-header kingdom-header">
                <span class="header-icon">üëë</span>
                <h2>Kingdom Management</h2>
            </div>
  
            <!-- Terrain Section -->
            <div class="army-card terrain-card">
                <div class="card-header terrain-header">
                    <span class="header-icon">üåø</span>
                    <h2>Terrain Claimed</h2>
                </div>
                <div class="card-content">
                    <div class="units-section">
                        <h3>Terrain Types</h3>
                        <div class="units-grid">
                            <div class="unit-row">
                                <label for="plains">Plains:</label>
                                <input type="number" id="plains" min="0" value="0" placeholder="0">
                            </div>
                            <div class="unit-row">
                                <label for="hills">Hills:</label>
                                <input type="number" id="hills" min="0" value="0" placeholder="0">
                            </div>
                            <div class="unit-row">
                                <label for="sea">Sea:</label>
                                <input type="number" id="sea" min="0" value="0" placeholder="0">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Building Section -->
            <div class="army-card building-card">
                <div class="card-header building-header">
                    <span class="header-icon">üèóÔ∏è</span>
                    <h2>Building Holdings</h2>
                </div>
                <div class="card-content">
                    <div class="units-section">
                        <h3>Building Types</h3>
                        <div class="units-grid">
                            <div class="unit-row">
                                <label for="castle">Castle:</label>
                                <input type="number" id="castle" min="0" value="0" placeholder="0">
                            </div>
                            <div class="unit-row">
                                <label for="mine">Mine:</label>
                                <input type="number" id="mine" min="0" value="0" placeholder="0">
                            </div>
                            <div class="unit-row">
                                <label for="fishery">Fishery:</label>
                                <input type="number" id="fishery" min="0" value="0" placeholder="0">
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="clear-btn" onclick="clearAllIncomeInputs()">
                    <span class="btn-icon">üóëÔ∏è</span>
                    Clear All Income
                </button>
                <button class="calculate-btn" onclick="calculateResourceIncome()">
                    <span class="btn-icon">üí∞</span>
                    Calculate Resource Income
                </button>
                <button class="calculate-btn" onclick="sendResourceIncomeToPool()">
                    <span class="btn-icon">üì•</span>
                    Send Resource Income to Pool
                </button>
            </div>
            
            <!-- Kingdom Results -->
            <div id="kingdomResults" class="results-section"></div>
        </div>

        <!-- UNIT MANAGEMENT -->
        <div class="army-card unit-card">
            <div class="card-header unit-header">
                <span class="header-icon">üõ°Ô∏è</span>
                <h2>Unit Management</h2>
            </div>

            <!-- Unit Recruitment Section -->
            <div class="army-card unit-recruitment-card">
                <div class="card-header unit-recruitment-header">
                    <span class="header-icon">‚öîÔ∏è</span>
                    <h2>Unit Recruitment</h2>
                </div>
                <div class="card-content">
                    <div class="units-section">
                        <h3>Available Units</h3>
                        <div id="recruitmentUnits" class="recruitment-grid"></div>
                    </div>
                </div>
            </div>
            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="clear-btn" onclick="clearAllExpensesInputs()">
                    <span class="btn-icon">üóëÔ∏è</span>
                    Clear All Expenses
                </button>
                <button class="calculate-btn" onclick="calculateUnitExpenses()">
                    <span class="btn-icon">üí∞</span>
                    Calculate Unit Expenses
                </button>
                <button class="calculate-btn" onclick="takeUnitExpensesFromPool()">
                    <span class="btn-icon">üì•</span>
                    Take Unit Expenses from Pool
                </button>
            </div>
            
            <!-- Expense Results -->
            <div id="expenseResults" class="results-section"></div>
        </div>
    </div>

    <!-- Results Section -->
    <div id="results" class="results-section" style="display: none;">
        <div class="results-wrapper">
            <div class="results-card">
                <div class="battle-results">
                    <h2>Resource Income Results</h2>
                    <div id="resourceResults"></div>
                </div>
            </div>
        </div>
    </div>


    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <!-- Custom Confirmation Modal -->
    <div id="confirmationModal" class="confirmation-modal">
        <div class="confirmation-content">
            <div class="confirmation-header">
                <h3>Confirm Action</h3>
            </div>
            <div class="confirmation-body">
                <p id="confirmationMessage"></p>
            </div>
            <div class="confirmation-footer">
                <button id="confirmButton" class="confirm-btn">Confirm</button>
                <button id="cancelButton" class="cancel-btn">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Global variable to store calculated income
        let calculatedIncome = null;
        
        // Custom confirmation function
        function showConfirmation(message, onConfirm, onCancel) {
            const modal = document.getElementById('confirmationModal');
            const messageElement = document.getElementById('confirmationMessage');
            const confirmBtn = document.getElementById('confirmButton');
            const cancelBtn = document.getElementById('cancelButton');
            
            messageElement.textContent = message;
            modal.classList.add('show');
            
            // Remove existing event listeners
            confirmBtn.replaceWith(confirmBtn.cloneNode(true));
            cancelBtn.replaceWith(cancelBtn.cloneNode(true));
            
            // Add new event listeners
            document.getElementById('confirmButton').addEventListener('click', () => {
                modal.classList.remove('show');
                if (onConfirm) onConfirm();
            });
            
            document.getElementById('cancelButton').addEventListener('click', () => {
                modal.classList.remove('show');
                if (onCancel) onCancel();
            });
            
            // Close on backdrop click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('show');
                    if (onCancel) onCancel();
                }
            });
        }
        
        // Unit data for each faction
        const factionUnits = {
            Empire: [
                { name: "Ranger", food: 5, gold: 3, iron: 2, other: 0 },
                { name: "Sentinel", food: 5, gold: 5, iron: 2, other: 0 },
                { name: "Siege Tower", food: 2, gold: 7, iron: 7, other: 0 },
                { name: "Corvette", food: 15, gold: 5, iron: 5, other: 0 },
                { name: "Galley", food: 10, gold: 3, iron: 3, other: 0 },
                { name: "Legionnaire", food: 5, gold: 50, iron: 2, other: 0 },
                { name: "Imperial Guard", food: 5, gold: 50, iron: 2, other: 0 }
            ],
            Raiders: [
                { name: "Raider", food: 5, gold: 2, iron: 2, other: 0 },
                { name: "Marauder", food: 5, gold: 4, iron: 3, other: 0 },
                { name: "Ballista", food: 2, gold: 4, iron: 4, other: 0 },
                { name: "Marauder", food: 15, gold: 4, iron: 4, other: 0 },
                { name: "Bireme", food: 10, gold: 3, iron: 3, other: 0 },
                { name: "Lord of the Swamp", food: 5, gold: 50, iron: 2, other: 0 },
                { name: "Lord of the Tides", food: 5, gold: 50, iron: 4, other: 0 }
            ],
            HORDE: [
                { name: "Bearzerker", food: 8, gold: 2, iron: 2, other: 0 },
                { name: "Yotes", food: 5, gold: 1, iron: 1, other: 0 },
                { name: "Battering Ram", food: 2, gold: 4, iron: 8, other: 0 },
                { name: "Warship", food: 15, gold: 5, iron: 5, other: 0 },
                { name: "Karve", food: 10, gold: 3, iron: 3, other: 0 },
                { name: "Shaiyan Battle Born", food: 8, gold: 50, iron: 2, other: 0 },
                { name: "Throgg Stone Face", food: 8, gold: 50, iron: 2, other: 0 }
            ],
            Ironborne: [
                { name: "Guardian", food: 8, gold: 2, iron: 4, other: 0 },
                { name: "Crossbow", food: 8, gold: 3, iron: 2, other: 0 },
                { name: "Trebuchet", food: 2, gold: 8, iron: 15, other: 0 },
                { name: "Ironclad", food: 15, gold: 6, iron: 6, other: 0 },
                { name: "Cruiser", food: 10, gold: 3, iron: 3, other: 0 },
                { name: "Death Knight", food: 8, gold: 50, iron: 4, other: 0 },
                { name: "Silverbolt", food: 8, gold: 50, iron: 2, other: 0 }
            ],
            Vanguard: [
                { name: "Swordsman", food: 5, gold: 2, iron: 3, other: 0 },
                { name: "Knight", food: 10, gold: 4, iron: 4, other: 0 },
                { name: "Catapult", food: 2, gold: 5, iron: 10, other: 0 },
                { name: "Destroyer", food: 15, gold: 7, iron: 7, other: 0 },
                { name: "Frigate", food: 10, gold: 3, iron: 3, other: 0 },
                { name: "Duke", food: 5, gold: 50, iron: 3, other: 0 },
                { name: "Archer", food: 5, gold: 50, iron: 3, other: 0 }
            ],
            Damned: [
                { name: "Thrall", food: 0, gold: 0, iron: 0, other: 0 },
                { name: "Lost Soul", food: 0, gold: 0, iron: 0, other: 0 },
                { name: "Harvester", food: 0, gold: 0, iron: 0, other: 5 },
                { name: "Plaguebringer", food: 0, gold: 0, iron: 0, other: 25 }
            ]
        };

        function updateRecruitmentUnits() {
            const faction = document.getElementById('recruitmentFaction').value;
            const units = factionUnits[faction] || [];
            const container = document.getElementById('recruitmentUnits');
            
            let html = '';
            units.forEach(unit => {
                html += `
                    <div class="recruitment-unit-row">
                        <div class="unit-info">
                            <span class="unit-name">${unit.name}</span>
                            <div class="unit-costs">
                                <span class="cost-item">
                                    <span class="cost-icon">üçñ</span>
                                    <span class="cost-value">${unit.food}</span>
                                </span>
                                <span class="cost-item">
                                    <span class="cost-icon">üí∞</span>
                                    <span class="cost-value">${unit.gold}</span>
                                </span>
                                <span class="cost-item">
                                    <span class="cost-icon">‚öíÔ∏è</span>
                                    <span class="cost-value">${unit.iron}</span>
                                </span>
                                <span class="cost-item">
                                    <span class="cost-icon">üì¶</span>
                                    <span class="cost-value">${unit.other}</span>
                                </span>
                            </div>
                        </div>
                        <div class="unit-controls">
                            <button class="unit-btn" onclick="decreaseUnit('${unit.name}')">-</button>
                            <span class="unit-quantity" id="quantity_${unit.name}">0</span>
                            <button class="unit-btn" onclick="increaseUnit('${unit.name}')">+</button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function increaseUnit(unitName) {
            const quantityElement = document.getElementById(`quantity_${unitName}`);
            const currentQuantity = parseInt(quantityElement.textContent) || 0;
            quantityElement.textContent = currentQuantity + 1;
        }

        function decreaseUnit(unitName) {
            const quantityElement = document.getElementById(`quantity_${unitName}`);
            const currentQuantity = parseInt(quantityElement.textContent) || 0;
            if (currentQuantity > 0) {
                quantityElement.textContent = currentQuantity - 1;
            }
        }

        function clearAllInputs() {
            // Clear all terrain inputs
            const terrainInputs = [
                'plains', 'forest', 'hills', 'sea'
            ];
            
            // Clear all building inputs
            const buildingInputs = [
                'castle', 'outpost', 'harbor', 'bloodshrine', 'mine', 'fishery', 'breeding_den'
            ];
            
            [...terrainInputs, ...buildingInputs].forEach(id => {
                document.getElementById(id).value = '0';
            });
            
            // Hide results
            document.getElementById('results').style.display = 'none';
            
            showNotification('All inputs cleared!', 'info');
        }

        function calculateResources() {
            // Collect terrain data
            const terrainData = {
                plains: parseInt(document.getElementById('plains').value) || 0,
                forest: parseInt(document.getElementById('forest').value) || 0,
                hills: parseInt(document.getElementById('hills').value) || 0,
                sea: parseInt(document.getElementById('sea').value) || 0
            };
            
            // Collect building data
            const buildingData = {
                castle: parseInt(document.getElementById('castle').value) || 0,
                outpost: parseInt(document.getElementById('outpost').value) || 0,
                harbor: parseInt(document.getElementById('harbor').value) || 0,
                bloodshrine: parseInt(document.getElementById('bloodshrine').value) || 0,
                mine: parseInt(document.getElementById('mine').value) || 0,
                fishery: parseInt(document.getElementById('fishery').value) || 0,
                breeding_den: parseInt(document.getElementById('breeding_den').value) || 0
            };
            
            // Prepare data for server
            const requestData = {
                terrain: terrainData,
                buildings: buildingData
            };
            
            // Show loading state
            showNotification('Calculating resources...', 'info');
            
            // Send to server
            fetch('/calculate_resources', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    displayResults(data.results);
                    showNotification('Resources calculated successfully!', 'success');
                } else {
                    showNotification('Error calculating resources: ' + data.error, 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Error connecting to server', 'error');
            });
        }

        function sendToResourcePool() {
            const resultsDiv = document.getElementById('resourceResults');
            if (resultsDiv.innerHTML === '') {
                showNotification('Please calculate resources first!', 'error');
                return;
            }

            // Get current pool values
            const poolFood = parseInt(document.getElementById('poolFood').value) || 0;
            const poolGold = parseInt(document.getElementById('poolGold').value) || 0;
            const poolIron = parseInt(document.getElementById('poolIron').value) || 0;
            const poolOther = parseInt(document.getElementById('poolOther').value) || 0;

            // Get calculated results (this would normally come from the server response)
            // For now, we'll simulate this with the displayed results
            const foodResult = document.querySelector('.resource-item:nth-child(1) .resource-value')?.textContent || '0';
            const goldResult = document.querySelector('.resource-item:nth-child(2) .resource-value')?.textContent || '0';
            const ironResult = document.querySelector('.resource-item:nth-child(3) .resource-value')?.textContent || '0';

            // Add calculated resources to pool
            document.getElementById('poolFood').value = poolFood + parseInt(foodResult);
            document.getElementById('poolGold').value = poolGold + parseInt(goldResult);
            document.getElementById('poolIron').value = poolIron + parseInt(ironResult);
            // Note: Other resource calculation would be added here when implemented

            showNotification('Resources added to pool!', 'success');
        }

        function displayResults(results) {
            const resultsDiv = document.getElementById('resourceResults');
            const resultsSection = document.getElementById('results');
            
            // Create results HTML
            let html = '<div class="resources-grid">';
            
            if (results.food !== undefined) {
                html += `<div class="resource-item">
                    <span class="resource-label">Food:</span>
                    <span class="resource-value">${results.food}</span>
                </div>`;
            }
            
            if (results.gold !== undefined) {
                html += `<div class="resource-item">
                    <span class="resource-label">Gold:</span>
                    <span class="resource-value">${results.gold}</span>
                </div>`;
            }
            
            if (results.iron !== undefined) {
                html += `<div class="resource-item">
                    <span class="resource-label">Iron:</span>
                    <span class="resource-value">${results.iron}</span>
                </div>`;
            }
            
            html += '</div>';
            
            resultsDiv.innerHTML = html;
            resultsSection.style.display = 'block';
        }

        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }


        // Income Calculation Functions
        function clearAllIncomeInputs() {
            // Clear terrain inputs
            const terrainInputs = ['plains', 'hills', 'sea'];
            terrainInputs.forEach(id => {
                const input = document.getElementById(id);
                if (input) input.value = '0';
            });
            
            // Clear building inputs
            const buildingInputs = ['castle', 'mine', 'fishery'];
            buildingInputs.forEach(id => {
                const input = document.getElementById(id);
                if (input) input.value = '0';
            });
            
            // Hide the kingdom results
            const kingdomResultsDiv = document.getElementById('kingdomResults');
            if (kingdomResultsDiv) {
                kingdomResultsDiv.innerHTML = '';
            }
            
            
            showNotification('All income inputs cleared!', 'success');
        }
        
        function calculateResourceIncome() {
            // Get terrain data
            const terrainData = {
                plains: parseInt(document.getElementById('plains').value) || 0,
                hills: parseInt(document.getElementById('hills').value) || 0,
                sea: parseInt(document.getElementById('sea').value) || 0
            };
            
            // Get building data
            const buildingData = {
                castles: parseInt(document.getElementById('castle').value) || 0,
                mines: parseInt(document.getElementById('mine').value) || 0,
                fisheries: parseInt(document.getElementById('fishery').value) || 0
            };
            
            // Calculate terrain income (example rates)
            const terrainIncome = {
                food: (terrainData.plains * 1),
                gold: (terrainData.hills * 3),
                iron: (terrainData.hills * 3),
                other: terrainData.sea * 0
            };
            
            // Get faction selection
            const factionSelection = document.getElementById('recruitmentFaction').value;
            
            // Calculate building income based on faction
            let buildingIncome;
            if (factionSelection === "Ironborne") {
                buildingIncome = {
                    food: (buildingData.castles * 5) + ((buildingData.fisheries > 0) ? (terrainData.sea * 1) : 0), 
                    gold: (buildingData.castles * 4) + ((buildingData.mines > 0) ? (terrainData.hills * 2) : 0),
                    iron: (buildingData.castles * 5) + ((buildingData.mines > 0) ? (terrainData.hills * 2) : 0),
                    other: 0
                };
            } else if (factionSelection === "Empire") {
                buildingIncome = {
                    food: (buildingData.castles * 5) + ((buildingData.fisheries > 0) ? (terrainData.sea * 1) : 0), 
                    gold: (buildingData.castles * 5) + ((buildingData.mines > 0) ? (terrainData.hills * 2) : 0),
                    iron: (buildingData.castles * 4) + ((buildingData.mines > 0) ? (terrainData.hills * 2) : 0),
                    other: 0
                };
            } else {
                buildingIncome = {
                    food: (buildingData.castles * 5) + ((buildingData.fisheries > 0) ? (terrainData.sea * 1) : 0), 
                    gold: (buildingData.castles * 4) + ((buildingData.mines > 0) ? (terrainData.hills * 2) : 0),
                    iron: (buildingData.castles * 4) + ((buildingData.mines > 0) ? (terrainData.hills * 2) : 0),
                    other: 0
                };
            }
            
            // Calculate round income from terrain and buildings
            const roundIncomeData = {
                food: terrainIncome.food + buildingIncome.food,
                gold: terrainIncome.gold + buildingIncome.gold,
                iron: terrainIncome.iron + buildingIncome.iron,
                other: terrainIncome.other + buildingIncome.other
            };
            
            // Total income (roundIncomeData is already terrain + building)
            const totalIncome = {
                food: roundIncomeData.food,
                gold: roundIncomeData.gold,
                iron: roundIncomeData.iron,
                other: roundIncomeData.other
            };
            
            // Store calculated income globally for use by sendResourceIncomeToPool
            calculatedIncome = totalIncome;
            
            // Display results in Kingdom Management style
            displayKingdomResults(terrainIncome, buildingIncome, roundIncomeData, totalIncome);
            
            showNotification('Resource income calculated!', 'success');
        }
        
        function sendResourceIncomeToPool() {
            // Check if income has been calculated
            if (!calculatedIncome) {
                showNotification('Please calculate resource income first!', 'error');
                return;
            }
            
            // Get current pool values
            const poolFood = parseInt(document.getElementById('poolFood').value) || 0;
            const poolGold = parseInt(document.getElementById('poolGold').value) || 0;
            const poolIron = parseInt(document.getElementById('poolIron').value) || 0;
            const poolOther = parseInt(document.getElementById('poolOther').value) || 0;
            
            // Calculate new pool values
            const newPoolFood = poolFood + calculatedIncome.food;
            const newPoolGold = poolGold + calculatedIncome.gold;
            const newPoolIron = poolIron + calculatedIncome.iron;
            const newPoolOther = poolOther + calculatedIncome.other;
            
            // Show confirmation popup
            const confirmMessage = `Add income to resource pool?\n\n` +
                `Current Pool:\n` +
                `üçñ Food: ${poolFood} ‚Üí ${newPoolFood}\n` +
                `üí∞ Gold: ${poolGold} ‚Üí ${newPoolGold}\n` +
                `‚öíÔ∏è Iron: ${poolIron} ‚Üí ${newPoolIron}\n` +
                `üì¶ Other: ${poolOther} ‚Üí ${newPoolOther}\n\n` +
                `Income to add:\n` +
                `üçñ Food: +${calculatedIncome.food}\n` +
                `üí∞ Gold: +${calculatedIncome.gold}\n` +
                `‚öíÔ∏è Iron: +${calculatedIncome.iron}\n` +
                `üì¶ Other: +${calculatedIncome.other}`;
            
            showConfirmation(confirmMessage, 
                () => {
                    // Update pool values
                    document.getElementById('poolFood').value = newPoolFood;
                    document.getElementById('poolGold').value = newPoolGold;
                    document.getElementById('poolIron').value = newPoolIron;
                    document.getElementById('poolOther').value = newPoolOther;
                    
                    showNotification(`Added ${calculatedIncome.food} food, ${calculatedIncome.gold} gold, ${calculatedIncome.iron} iron, ${calculatedIncome.other} other to resource pool!`, 'success');
                },
                () => {
                    showNotification('Resource income transfer cancelled.', 'info');
                }
            );
        }
        
        function displayKingdomResults(terrainIncome, buildingIncome, roundIncome, totalIncome) {
            const resultsDiv = document.getElementById('kingdomResults');
            if (!resultsDiv) return;
            
            // Get building data for display
            const buildingData = {
                castles: parseInt(document.getElementById('castle').value) || 0,
                mines: parseInt(document.getElementById('mine').value) || 0,
                fisheries: parseInt(document.getElementById('fishery').value) || 0
            };
            
            // Get terrain data for display
            const terrainData = {
                hills: parseInt(document.getElementById('hills').value) || 0,
                sea: parseInt(document.getElementById('sea').value) || 0
            };
            
            let html = `
                <div class="kingdom-results">
                    <h4>Kingdom Income Breakdown</h4>
                    <div class="kingdom-grid">
                        <div class="kingdom-section">
                            <h5>Terrain Sources</h5>
                            <div class="terrain-breakdown">
                                <div class="terrain-item">
                                    <strong>Plains</strong>
                                    <div class="terrain-costs">
                                        <span>üçñ ${terrainIncome.food}</span>
                                    </div>
                                </div>
                                <div class="terrain-item">
                                    <strong>Hills</strong>
                                    <div class="terrain-costs">
                                        <span>üí∞ ${terrainIncome.gold}</span>
                                        <span>‚öíÔ∏è ${terrainIncome.iron}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="kingdom-section">
                            <h5>Building Sources</h5>
                            <div class="building-breakdown">
                                <div class="building-item">
                                    <strong>Castles</strong>
                                    <div class="building-costs">
                                        <span>üçñ ${buildingData.castles * 5}</span>
                                        <span>üí∞ ${buildingData.castles * 4}</span>
                                        <span>‚öíÔ∏è ${buildingData.castles * 4}</span>
                                    </div>
                                </div>
                                <div class="building-item">
                                    <strong>Mines</strong>
                                    <div class="building-costs">
                                        <span>üí∞ ${buildingData.mines > 0 ? terrainData.hills * 2 : 0}</span>
                                        <span>‚öíÔ∏è ${buildingData.mines > 0 ? terrainData.hills * 2 : 0}</span>
                                    </div>
                                </div>
                                <div class="building-item">
                                    <strong>Fisheries</strong>
                                    <div class="building-costs">
                                        <span>üçñ ${buildingData.fisheries > 0 ? terrainData.sea * 1 : 0}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="kingdom-section total-section">
                            <h5>Total Kingdom Income</h5>
                            <div class="total-breakdown">
                                <div class="total-item">üçñ Food: ${totalIncome.food}</div>
                                <div class="total-item">üí∞ Gold: ${totalIncome.gold}</div>
                                <div class="total-item">‚öíÔ∏è Iron: ${totalIncome.iron}</div>
                                <div class="total-item">üì¶ Other: ${totalIncome.other}</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            resultsDiv.innerHTML = html;
        }

        // Expense Calculation Functions
        function clearAllExpensesInputs() {
            // Clear all unit quantity inputs
            const unitQuantities = document.querySelectorAll('.unit-quantity');
            unitQuantities.forEach(quantity => {
                quantity.textContent = '0';
            });
            
            showNotification('All expense inputs cleared!', 'success');
        }
        
        function calculateUnitExpenses() {
            const faction = document.getElementById('recruitmentFaction').value;
            const units = factionUnits[faction] || [];
            
            let totalExpenses = {
                food: 0,
                gold: 0,
                iron: 0,
                other: 0
            };
            
            let unitBreakdown = [];
            
            units.forEach(unit => {
                const quantity = parseInt(document.getElementById(`quantity_${unit.name}`).textContent) || 0;
                if (quantity > 0) {
                    const unitExpense = {
                        name: unit.name,
                        quantity: quantity,
                        food: unit.food * quantity,
                        gold: unit.gold * quantity,
                        iron: unit.iron * quantity,
                        other: unit.thrall_egg_fae * quantity
                    };
                    
                    unitBreakdown.push(unitExpense);
                    
                    totalExpenses.food += unitExpense.food;
                    totalExpenses.gold += unitExpense.gold;
                    totalExpenses.iron += unitExpense.iron;
                    totalExpenses.other += unitExpense.other;
                }
            });
            
            // Display results
            displayExpenseResults(unitBreakdown, totalExpenses);
            
            showNotification('Unit expenses calculated!', 'success');
        }
        
        function takeUnitExpensesFromPool() {
            // Get current pool values
            const poolFood = parseInt(document.getElementById('poolFood').value) || 0;
            const poolGold = parseInt(document.getElementById('poolGold').value) || 0;
            const poolIron = parseInt(document.getElementById('poolIron').value) || 0;
            const poolOther = parseInt(document.getElementById('poolOther').value) || 0;
            
            // Calculate expenses
            const faction = document.getElementById('recruitmentFaction').value;
            const units = factionUnits[faction] || [];
            
            let totalExpenses = {
                food: 0,
                gold: 0,
                iron: 0,
                other: 0
            };
            
            let unitBreakdown = [];
            
            units.forEach(unit => {
                const quantity = parseInt(document.getElementById(`quantity_${unit.name}`).textContent) || 0;
                if (quantity > 0) {
                    const unitExpense = {
                        name: unit.name,
                        quantity: quantity,
                        food: unit.food * quantity,
                        gold: unit.gold * quantity,
                        iron: unit.iron * quantity,
                        other: unit.thrall_egg_fae * quantity
                    };
                    
                    unitBreakdown.push(unitExpense);
                    
                    totalExpenses.food += unitExpense.food;
                    totalExpenses.gold += unitExpense.gold;
                    totalExpenses.iron += unitExpense.iron;
                    totalExpenses.other += unitExpense.other;
                }
            });
            
            // Check if any units are selected
            if (totalExpenses.food === 0 && totalExpenses.gold === 0 && totalExpenses.iron === 0 && totalExpenses.other === 0) {
                showNotification('Please select units to recruit first!', 'error');
                return;
            }
            
            // Check if pool has enough resources
            if (poolFood < totalExpenses.food || poolGold < totalExpenses.gold || 
                poolIron < totalExpenses.iron || poolOther < totalExpenses.other) {
                showNotification('Not enough resources in pool!', 'error');
                return;
            }
            
            // Calculate new pool values
            const newPoolFood = poolFood - totalExpenses.food;
            const newPoolGold = poolGold - totalExpenses.gold;
            const newPoolIron = poolIron - totalExpenses.iron;
            const newPoolOther = poolOther - totalExpenses.other;
            
            // Build unit breakdown for confirmation
            let unitDetails = '';
            unitBreakdown.forEach(unit => {
                unitDetails += `${unit.name} (${unit.quantity}): üçñ${unit.food} üí∞${unit.gold} ‚öíÔ∏è${unit.iron} üì¶${unit.other}\n`;
            });
            
            // Show confirmation popup
            const confirmMessage = `Deduct unit expenses from resource pool?\n\n` +
                `Current Pool:\n` +
                `üçñ Food: ${poolFood} ‚Üí ${newPoolFood}\n` +
                `üí∞ Gold: ${poolGold} ‚Üí ${newPoolGold}\n` +
                `‚öíÔ∏è Iron: ${poolIron} ‚Üí ${newPoolIron}\n` +
                `üì¶ Other: ${poolOther} ‚Üí ${newPoolOther}\n\n` +
                `Units to recruit:\n${unitDetails}\n` +
                `Total expenses:\n` +
                `üçñ Food: -${totalExpenses.food}\n` +
                `üí∞ Gold: -${totalExpenses.gold}\n` +
                `‚öíÔ∏è Iron: -${totalExpenses.iron}\n` +
                `üì¶ Other: -${totalExpenses.other}`;
            
            showConfirmation(confirmMessage, 
                () => {
                    // Deduct from pool
                    document.getElementById('poolFood').value = newPoolFood;
                    document.getElementById('poolGold').value = newPoolGold;
                    document.getElementById('poolIron').value = newPoolIron;
                    document.getElementById('poolOther').value = newPoolOther;
                    
                    showNotification(`Deducted ${totalExpenses.food} food, ${totalExpenses.gold} gold, ${totalExpenses.iron} iron, ${totalExpenses.other} other from resource pool!`, 'success');
                },
                () => {
                    showNotification('Unit expense deduction cancelled.', 'info');
                }
            );
        }
        
        function displayExpenseResults(unitBreakdown, totalExpenses) {
            const resultsDiv = document.getElementById('expenseResults');
            if (!resultsDiv) return;
            
            let html = `
                <div class="expense-results">
                    <h4>Unit Expenses Breakdown</h4>
                    <div class="expense-grid">
                        <div class="expense-section">
                            <h5>Unit Costs</h5>
            `;
            
            unitBreakdown.forEach(unit => {
                html += `
                    <div class="expense-item">
                        <strong>${unit.name} (${unit.quantity})</strong>
                        <div class="unit-costs">
                            <span>üçñ ${unit.food}</span>
                            <span>üí∞ ${unit.gold}</span>
                            <span>‚öíÔ∏è ${unit.iron}</span>
                            <span>üì¶ ${unit.other}</span>
                        </div>
                    </div>
                `;
            });
            
            html += `
                        </div>
                        <div class="expense-section total-section">
                            <h5>Total Expenses</h5>
                            <div class="expense-item total">üçñ Food: ${totalExpenses.food}</div>
                            <div class="expense-item total">üí∞ Gold: ${totalExpenses.gold}</div>
                            <div class="expense-item total">‚öíÔ∏è Iron: ${totalExpenses.iron}</div>
                            <div class="expense-item total">üì¶ Other: ${totalExpenses.other}</div>
                        </div>
                    </div>
                </div>
            `;
            
            resultsDiv.innerHTML = html;
        }

        // Round Counter Functions
        function increaseRound() {
            const roundInput = document.getElementById('currentRound');
            const currentRound = parseInt(roundInput.value) || 1;
            roundInput.value = currentRound + 1;
            updateRound();
        }

        function decreaseRound() {
            const roundInput = document.getElementById('currentRound');
            const currentRound = parseInt(roundInput.value) || 1;
            if (currentRound > 1) {
                roundInput.value = currentRound - 1;
                updateRound();
            }
        }

        function updateRound() {
            const roundInput = document.getElementById('currentRound');
            const currentRound = parseInt(roundInput.value) || 1;
            
            // Ensure minimum round is 1
            if (currentRound < 1) {
                roundInput.value = 1;
            }
            
            // You can add additional logic here for round-specific functionality
            console.log('Current round:', roundInput.value);
        }

        // Initialize recruitment units on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateRecruitmentUnits();
        });
    </script>

</body>

</html> 