<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HEX Wars Resource Calculator</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Logo -->
    <div class="logo-container">
        <img src="static/images/logo.jpg" alt="HEX Wars Logo" class="logo-image" />
    </div>

    <h1>HEX WARS RESOURCE CALCULATOR</h1>

    <!-- Navigation Card -->
    <div class="nav-card">
        <a href="index.html" class="nav-btn battle-btn">
            <span class="btn-icon">‚öîÔ∏è</span>
            <span class="btn-text">Battle Calculator</span>
        </a>
        <a href="factions.html" class="nav-btn factions-btn">
            <span class="btn-icon">üìã</span>
            <span class="btn-text">Faction Details</span>
        </a>
        <a href="login.html" class="nav-btn login-btn">
            <span class="btn-icon">üë§</span>
            <span class="btn-text">Character Creation</span>
        </a>
        <a href="character.html" class="nav-btn character-btn">
            <span class="btn-icon">‚öîÔ∏è</span>
            <span class="btn-text">My Characters</span>
        </a>
    </div>

    <!-- Round Counter Section -->
    <div class="round-counter-section">
        <div class="round-counter-card">
            <div class="round-counter-header">
                <span class="round-counter-icon">üéØ</span>
                <h3>Current Round</h3>
            </div>
            <div class="round-counter-controls">
                <button class="round-btn" onclick="decreaseRound()" title="Previous Round">
                    <span>‚àí</span>
                </button>
                <div class="round-display">
                    <input type="number" id="currentRound" min="1" value="1" onchange="updateRound()">
                    <span class="round-label">Round</span>
                </div>
                <button class="round-btn" onclick="increaseRound()" title="Next Round">
                    <span>+</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Resource Pool Section -->
    <div class="resource-pool-section">
        <div class="army-card resources-card">
            <div class="card-header resources-header">
                <span class="header-icon">üíé</span>
                <h2>Resource Pool</h2>
            </div>
            <div class="card-content">
                <div class="resource-pool-grid">
                    <div class="resource-pool-item">
                        <span class="resource-icon">üçñ</span>
                        <label for="poolFood">Food:</label>
                        <input type="number" id="poolFood" min="0" value="0" placeholder="0">
                    </div>
                    <div class="resource-pool-item">
                        <span class="resource-icon">üí∞</span>
                        <label for="poolGold">Gold:</label>
                        <input type="number" id="poolGold" min="0" value="0" placeholder="0">
                    </div>
                    <div class="resource-pool-item">
                        <span class="resource-icon">‚öíÔ∏è</span>
                        <label for="poolIron">Iron:</label>
                        <input type="number" id="poolIron" min="0" value="0" placeholder="0">
                    </div>
                    <div class="resource-pool-item">
                        <span class="resource-icon">üì¶</span>
                        <label for="poolOther">Other:</label>
                        <input type="number" id="poolOther" min="0" value="0" placeholder="0">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Resource Calculator Container -->
    <div class="calculator-container">
        <!-- KINGDOM MANAGEMENT -->
        <div class="army-card kingdom-card">
            <div class="card-header kingdom-header">
                <span class="header-icon">üëë</span>
                <h2>Kingdom Management</h2>
            </div>
  
            <!-- Terrain Section -->
            <div class="army-card terrain-card">
                <div class="card-header terrain-header">
                    <span class="header-icon">üåø</span>
                    <h2>Terrain Claimed</h2>
                </div>
                <div class="card-content">
                    <div class="units-section">
                        <h3>Terrain Types</h3>
                        <div class="units-grid">
                            <div class="unit-row">
                                <label for="plains">Plains:</label>
                                <input type="number" id="plains" min="0" value="0" placeholder="0">
                            </div>
                            <div class="unit-row">
                                <label for="forest">Forest:</label>
                                <input type="number" id="forest" min="0" value="0" placeholder="0">
                            </div>
                            <div class="unit-row">
                                <label for="hills">Hills:</label>
                                <input type="number" id="hills" min="0" value="0" placeholder="0">
                            </div>
                            <div class="unit-row">
                                <label for="sea">Sea:</label>
                                <input type="number" id="sea" min="0" value="0" placeholder="0">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Building Section -->
            <div class="army-card building-card">
                <div class="card-header building-header">
                    <span class="header-icon">üèóÔ∏è</span>
                    <h2>Building Holdings</h2>
                </div>
                <div class="card-content">
                    <div class="units-section">
                        <h3>Building Types</h3>
                        <div class="units-grid">
                            <div class="unit-row">
                                <label for="castle">Castle:</label>
                                <input type="number" id="castle" min="0" value="0" placeholder="0">
                            </div>
                            <div class="unit-row">
                                <label for="outpost">Outpost:</label>
                                <input type="number" id="outpost" min="0" value="0" placeholder="0">
                            </div>
                            <div class="unit-row">
                                <label for="harbor">Harbor:</label>
                                <input type="number" id="harbor" min="0" value="0" placeholder="0">
                            </div>
                            <div class="unit-row">
                                <label for="bloodshrine">Bloodshrine:</label>
                                <input type="number" id="bloodshrine" min="0" value="0" placeholder="0">
                            </div>
                            <div class="unit-row">
                                <label for="mine">Mine:</label>
                                <input type="number" id="mine" min="0" value="0" placeholder="0">
                            </div>
                            <div class="unit-row">
                                <label for="fishery">Fishery:</label>
                                <input type="number" id="fishery" min="0" value="0" placeholder="0">
                            </div>
                            <div class="unit-row">
                                <label for="breeding_den">Breeding Den:</label>
                                <input type="number" id="breeding_den" min="0" value="0" placeholder="0">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Round Income Section -->
            <div id="roundIncomeSection" class="army-card recruitment-card" style="display: none;">
                <div class="card-header resources-header">
                    <span class="header-icon">üìà</span>
                    <h2>Round Income</h2>
                </div>
                <div class="card-content">
                    <div class="units-section">
                        <h3>Round Income Breakdown</h3>
                        <div id="roundIncomeBreakdown" class="income-breakdown">
                            <div class="breakdown-section">
                                <h4>Terrain Income</h4>
                                <div class="breakdown-grid">
                                    <div class="breakdown-item">
                                        <span class="resource-icon">üçñ</span>
                                        <span class="breakdown-label">Food:</span>
                                        <span class="breakdown-value" id="terrainFoodIncome">0</span>
                                    </div>
                                    <div class="breakdown-item">
                                        <span class="resource-icon">üí∞</span>
                                        <span class="breakdown-label">Gold:</span>
                                        <span class="breakdown-value" id="terrainGoldIncome">0</span>
                                    </div>
                                    <div class="breakdown-item">
                                        <span class="resource-icon">‚öíÔ∏è</span>
                                        <span class="breakdown-label">Iron:</span>
                                        <span class="breakdown-value" id="terrainIronIncome">0</span>
                                    </div>
                                    <div class="breakdown-item">
                                        <span class="resource-icon">üì¶</span>
                                        <span class="breakdown-label">Other:</span>
                                        <span class="breakdown-value" id="terrainOtherIncome">0</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="breakdown-section">
                                <h4>Building Income</h4>
                                <div class="breakdown-grid">
                                    <div class="breakdown-item">
                                        <span class="resource-icon">üçñ</span>
                                        <span class="breakdown-label">Food:</span>
                                        <span class="breakdown-value" id="buildingFoodIncome">0</span>
                                    </div>
                                    <div class="breakdown-item">
                                        <span class="resource-icon">üí∞</span>
                                        <span class="breakdown-label">Gold:</span>
                                        <span class="breakdown-value" id="buildingGoldIncome">0</span>
                                    </div>
                                    <div class="breakdown-item">
                                        <span class="resource-icon">‚öíÔ∏è</span>
                                        <span class="breakdown-label">Iron:</span>
                                        <span class="breakdown-value" id="buildingIronIncome">0</span>
                                    </div>
                                    <div class="breakdown-item">
                                        <span class="resource-icon">üì¶</span>
                                        <span class="breakdown-label">Other:</span>
                                        <span class="breakdown-value" id="buildingOtherIncome">0</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="breakdown-section total-breakdown">
                                <h4>Total Round Income</h4>
                                <div class="breakdown-grid">
                                    <div class="breakdown-item total-item">
                                        <span class="resource-icon">üçñ</span>
                                        <span class="breakdown-label">Food:</span>
                                        <span class="breakdown-value total-value" id="totalFoodIncome">0</span>
                                    </div>
                                    <div class="breakdown-item total-item">
                                        <span class="resource-icon">üí∞</span>
                                        <span class="breakdown-label">Gold:</span>
                                        <span class="breakdown-value total-value" id="totalGoldIncome">0</span>
                                    </div>
                                    <div class="breakdown-item total-item">
                                        <span class="resource-icon">‚öíÔ∏è</span>
                                        <span class="breakdown-label">Iron:</span>
                                        <span class="breakdown-value total-value" id="totalIronIncome">0</span>
                                    </div>
                                    <div class="breakdown-item total-item">
                                        <span class="resource-icon">üì¶</span>
                                        <span class="breakdown-label">Other:</span>
                                        <span class="breakdown-value total-value" id="totalOtherIncome">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="clear-btn" onclick="clearAllIncomeInputs()">
                    <span class="btn-icon">üóëÔ∏è</span>
                    Clear All Income
                </button>
                <button class="calculate-btn" onclick="calculateResourceIncome()">
                    <span class="btn-icon">üí∞</span>
                    Calculate Resource Income
                </button>
                <button class="calculate-btn" onclick="sendResourceIncomeToPool()">
                    <span class="btn-icon">üì•</span>
                    Send Resource Income to Pool
                </button>
            </div>
            
            <!-- Kingdom Results -->
            <div id="kingdomResults" class="results-section"></div>
        </div>

        <!-- UNIT MANAGEMENT -->
        <div class="army-card unit-card">
            <div class="card-header unit-header">
                <span class="header-icon">üõ°Ô∏è</span>
                <h2>Unit Management</h2>
            </div>

            <!-- Unit Recruitment Section -->
            <div class="army-card unit-recruitment-card">
                <div class="card-header unit-recruitment-header">
                    <span class="header-icon">‚öîÔ∏è</span>
                    <h2>Unit Recruitment</h2>
                </div>
                <div class="card-content">
                    <div class="faction-selector">
                        <label for="recruitmentFaction">Faction:</label>
                        <select id="recruitmentFaction" onchange="updateRecruitmentUnits()">
                            <option value="Empire">Empire</option>
                            <option value="Raiders">Raiders</option>
                            <option value="HORDE">HORDE</option>
                            <option value="Ironborne">Ironborne</option>
                            <option value="Vanguard">Vanguard</option>
                            <option value="Damned">Damned</option>
                        </select>
                    </div>
                    <div class="units-section">
                        <h3>Available Units</h3>
                        <div id="recruitmentUnits" class="recruitment-grid"></div>
                    </div>
                </div>
            </div>
            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="clear-btn" onclick="clearAllExpensesInputs()">
                    <span class="btn-icon">üóëÔ∏è</span>
                    Clear All Expenses
                </button>
                <button class="calculate-btn" onclick="calculateUnitExpenses()">
                    <span class="btn-icon">üí∞</span>
                    Calculate Unit Expenses
                </button>
                <button class="calculate-btn" onclick="takeUnitExpensesFromPool()">
                    <span class="btn-icon">üì•</span>
                    Take Unit Expenses from Pool
                </button>
            </div>
            
            <!-- Expense Results -->
            <div id="expenseResults" class="results-section"></div>
        </div>
    </div>

    <!-- Results Section -->
    <div id="results" class="results-section" style="display: none;">
        <div class="results-wrapper">
            <div class="results-card">
                <div class="battle-results">
                    <h2>Resource Income Results</h2>
                    <div id="resourceResults"></div>
                </div>
            </div>
        </div>
    </div>


    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <script>
        // Unit data for each faction
        const factionUnits = {
            Empire: [
                { name: "Ranger", food: 5, gold: 3, iron: 2, other: 0 },
                { name: "Sentinel", food: 5, gold: 5, iron: 2, other: 0 },
                { name: "Siege Tower", food: 2, gold: 7, iron: 7, other: 0 },
                { name: "Corvette", food: 15, gold: 5, iron: 5, other: 0 },
                { name: "Galley", food: 10, gold: 3, iron: 3, other: 0 },
                { name: "Legionnaire", food: 5, gold: 50, iron: 2, other: 0 },
                { name: "Imperial Guard", food: 5, gold: 50, iron: 2, other: 0 }
            ],
            Raiders: [
                { name: "Raider", food: 5, gold: 2, iron: 2, other: 0 },
                { name: "Marauder", food: 5, gold: 4, iron: 3, other: 0 },
                { name: "Ballista", food: 2, gold: 4, iron: 4, other: 0 },
                { name: "Marauder", food: 15, gold: 4, iron: 4, other: 0 },
                { name: "Bireme", food: 10, gold: 3, iron: 3, other: 0 },
                { name: "Lord of the Swamp", food: 5, gold: 50, iron: 2, other: 0 },
                { name: "Lord of the Tides", food: 5, gold: 50, iron: 4, other: 0 }
            ],
            HORDE: [
                { name: "Bearzerker", food: 8, gold: 2, iron: 2, other: 0 },
                { name: "Yotes", food: 5, gold: 1, iron: 1, other: 0 },
                { name: "Battering Ram", food: 2, gold: 4, iron: 8, other: 0 },
                { name: "Warship", food: 15, gold: 5, iron: 5, other: 0 },
                { name: "Karve", food: 10, gold: 3, iron: 3, other: 0 },
                { name: "Shaiyan Battle Born", food: 8, gold: 50, iron: 2, other: 0 },
                { name: "Throgg Stone Face", food: 8, gold: 50, iron: 2, other: 0 }
            ],
            Ironborne: [
                { name: "Guardian", food: 8, gold: 2, iron: 4, other: 0 },
                { name: "Crossbow", food: 8, gold: 3, iron: 2, other: 0 },
                { name: "Trebuchet", food: 2, gold: 8, iron: 15, other: 0 },
                { name: "Ironclad", food: 15, gold: 6, iron: 6, other: 0 },
                { name: "Cruiser", food: 10, gold: 3, iron: 3, other: 0 },
                { name: "Death Knight", food: 8, gold: 50, iron: 4, other: 0 },
                { name: "Silverbolt", food: 8, gold: 50, iron: 2, other: 0 }
            ],
            Vanguard: [
                { name: "Swordsman", food: 5, gold: 2, iron: 3, other: 0 },
                { name: "Knight", food: 10, gold: 4, iron: 4, other: 0 },
                { name: "Catapult", food: 2, gold: 5, iron: 10, other: 0 },
                { name: "Destroyer", food: 15, gold: 7, iron: 7, other: 0 },
                { name: "Frigate", food: 10, gold: 3, iron: 3, other: 0 },
                { name: "Duke", food: 5, gold: 50, iron: 3, other: 0 },
                { name: "Archer", food: 5, gold: 50, iron: 3, other: 0 }
            ],
            Damned: [
                { name: "Thrall", food: 0, gold: 0, iron: 0, other: 0 },
                { name: "Lost Soul", food: 0, gold: 0, iron: 0, other: 0 },
                { name: "Harvester", food: 0, gold: 0, iron: 0, other: 5 },
                { name: "Plaguebringer", food: 0, gold: 0, iron: 0, other: 25 }
            ]
        };

        function updateRecruitmentUnits() {
            const faction = document.getElementById('recruitmentFaction').value;
            const units = factionUnits[faction] || [];
            const container = document.getElementById('recruitmentUnits');
            
            let html = '';
            units.forEach(unit => {
                html += `
                    <div class="recruitment-unit-row">
                        <div class="unit-info">
                            <span class="unit-name">${unit.name}</span>
                            <div class="unit-costs">
                                <span class="cost-item">
                                    <span class="cost-icon">üçñ</span>
                                    <span class="cost-value">${unit.food}</span>
                                </span>
                                <span class="cost-item">
                                    <span class="cost-icon">üí∞</span>
                                    <span class="cost-value">${unit.gold}</span>
                                </span>
                                <span class="cost-item">
                                    <span class="cost-icon">‚öíÔ∏è</span>
                                    <span class="cost-value">${unit.iron}</span>
                                </span>
                                <span class="cost-item">
                                    <span class="cost-icon">üì¶</span>
                                    <span class="cost-value">${unit.other}</span>
                                </span>
                            </div>
                        </div>
                        <div class="unit-controls">
                            <button class="unit-btn" onclick="decreaseUnit('${unit.name}')">-</button>
                            <span class="unit-quantity" id="quantity_${unit.name}">0</span>
                            <button class="unit-btn" onclick="increaseUnit('${unit.name}')">+</button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function increaseUnit(unitName) {
            const quantityElement = document.getElementById(`quantity_${unitName}`);
            const currentQuantity = parseInt(quantityElement.textContent) || 0;
            quantityElement.textContent = currentQuantity + 1;
        }

        function decreaseUnit(unitName) {
            const quantityElement = document.getElementById(`quantity_${unitName}`);
            const currentQuantity = parseInt(quantityElement.textContent) || 0;
            if (currentQuantity > 0) {
                quantityElement.textContent = currentQuantity - 1;
            }
        }

        function clearAllInputs() {
            // Clear all terrain inputs
            const terrainInputs = [
                'plains', 'forest', 'hills', 'sea'
            ];
            
            // Clear all building inputs
            const buildingInputs = [
                'castle', 'outpost', 'harbor', 'bloodshrine', 'mine', 'fishery', 'breeding_den'
            ];
            
            [...terrainInputs, ...buildingInputs].forEach(id => {
                document.getElementById(id).value = '0';
            });
            
            // Hide results
            document.getElementById('results').style.display = 'none';
            
            showNotification('All inputs cleared!', 'info');
        }

        function calculateResources() {
            // Collect terrain data
            const terrainData = {
                plains: parseInt(document.getElementById('plains').value) || 0,
                forest: parseInt(document.getElementById('forest').value) || 0,
                hills: parseInt(document.getElementById('hills').value) || 0,
                sea: parseInt(document.getElementById('sea').value) || 0
            };
            
            // Collect building data
            const buildingData = {
                castle: parseInt(document.getElementById('castle').value) || 0,
                outpost: parseInt(document.getElementById('outpost').value) || 0,
                harbor: parseInt(document.getElementById('harbor').value) || 0,
                bloodshrine: parseInt(document.getElementById('bloodshrine').value) || 0,
                mine: parseInt(document.getElementById('mine').value) || 0,
                fishery: parseInt(document.getElementById('fishery').value) || 0,
                breeding_den: parseInt(document.getElementById('breeding_den').value) || 0
            };
            
            // Prepare data for server
            const requestData = {
                terrain: terrainData,
                buildings: buildingData
            };
            
            // Show loading state
            showNotification('Calculating resources...', 'info');
            
            // Send to server
            fetch('/calculate_resources', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    displayResults(data.results);
                    showNotification('Resources calculated successfully!', 'success');
                } else {
                    showNotification('Error calculating resources: ' + data.error, 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Error connecting to server', 'error');
            });
        }

        function sendToResourcePool() {
            const resultsDiv = document.getElementById('resourceResults');
            if (resultsDiv.innerHTML === '') {
                showNotification('Please calculate resources first!', 'error');
                return;
            }

            // Get current pool values
            const poolFood = parseInt(document.getElementById('poolFood').value) || 0;
            const poolGold = parseInt(document.getElementById('poolGold').value) || 0;
            const poolIron = parseInt(document.getElementById('poolIron').value) || 0;
            const poolOther = parseInt(document.getElementById('poolOther').value) || 0;

            // Get calculated results (this would normally come from the server response)
            // For now, we'll simulate this with the displayed results
            const foodResult = document.querySelector('.resource-item:nth-child(1) .resource-value')?.textContent || '0';
            const goldResult = document.querySelector('.resource-item:nth-child(2) .resource-value')?.textContent || '0';
            const ironResult = document.querySelector('.resource-item:nth-child(3) .resource-value')?.textContent || '0';

            // Add calculated resources to pool
            document.getElementById('poolFood').value = poolFood + parseInt(foodResult);
            document.getElementById('poolGold').value = poolGold + parseInt(goldResult);
            document.getElementById('poolIron').value = poolIron + parseInt(ironResult);
            // Note: Other resource calculation would be added here when implemented

            showNotification('Resources added to pool!', 'success');
        }

        function displayResults(results) {
            const resultsDiv = document.getElementById('resourceResults');
            const resultsSection = document.getElementById('results');
            
            // Create results HTML
            let html = '<div class="resources-grid">';
            
            if (results.food !== undefined) {
                html += `<div class="resource-item">
                    <span class="resource-label">Food:</span>
                    <span class="resource-value">${results.food}</span>
                </div>`;
            }
            
            if (results.gold !== undefined) {
                html += `<div class="resource-item">
                    <span class="resource-label">Gold:</span>
                    <span class="resource-value">${results.gold}</span>
                </div>`;
            }
            
            if (results.iron !== undefined) {
                html += `<div class="resource-item">
                    <span class="resource-label">Iron:</span>
                    <span class="resource-value">${results.iron}</span>
                </div>`;
            }
            
            html += '</div>';
            
            resultsDiv.innerHTML = html;
            resultsSection.style.display = 'block';
        }

        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Round Income Display Functions
        function updateRoundIncomeDisplay() {
            // Get terrain data
            const terrainData = {
                plains: parseInt(document.getElementById('plains').value) || 0,
                forest: parseInt(document.getElementById('forest').value) || 0,
                hills: parseInt(document.getElementById('hills').value) || 0,
                sea: parseInt(document.getElementById('sea').value) || 0
            };
            
            // Get building data
            const buildingData = {
                outposts: parseInt(document.getElementById('outpost').value) || 0,
                ports: parseInt(document.getElementById('harbor').value) || 0,
                castles: parseInt(document.getElementById('castle').value) || 0,
                bloodshrines: parseInt(document.getElementById('bloodshrine').value) || 0,
                mines: parseInt(document.getElementById('mine').value) || 0,
                fisheries: parseInt(document.getElementById('fishery').value) || 0,
                breeding_dens: parseInt(document.getElementById('breeding_den').value) || 0
            };
            
            // Calculate terrain income (WORKING) HOW DO MATH?
            const terrainIncome = {
                food: (terrainData.plains * 1) + (terrainData.sea * 0),
                gold: terrainData.hills * 3,
                iron: terrainData.hills * 3,
                other: terrainData.sea * 0
            };
            
            // Calculate building income (WORKING) HOW DO MATH?
            const buildingIncome = {
                food: (buildingData.castle * 5) + (buildingData.fisheries * 1), 
                gold: (buildingData.castle * 4) + (buildingData.mine * 2),
                iron: (buildingData.castle * 4) + (buildingData.mine * 2),
                other: buildingData.harbor * 0
            };
            
            // Total round income
            const totalRoundIncome = {
                food: terrainIncome.food + buildingIncome.food,
                gold: terrainIncome.gold + buildingIncome.gold,
                iron: terrainIncome.iron + buildingIncome.iron,
                other: terrainIncome.other + buildingIncome.other
            };
            
            // Update terrain income display
            document.getElementById('terrainFoodIncome').textContent = terrainIncome.food;
            document.getElementById('terrainGoldIncome').textContent = terrainIncome.gold;
            document.getElementById('terrainIronIncome').textContent = terrainIncome.iron;
            document.getElementById('terrainOtherIncome').textContent = terrainIncome.other;
            
            // Update building income display
            document.getElementById('buildingFoodIncome').textContent = buildingIncome.food;
            document.getElementById('buildingGoldIncome').textContent = buildingIncome.gold;
            document.getElementById('buildingIronIncome').textContent = buildingIncome.iron;
            document.getElementById('buildingOtherIncome').textContent = buildingIncome.other;
            
            // Update total income display
            document.getElementById('totalFoodIncome').textContent = totalRoundIncome.food;
            document.getElementById('totalGoldIncome').textContent = totalRoundIncome.gold;
            document.getElementById('totalIronIncome').textContent = totalRoundIncome.iron;
            document.getElementById('totalOtherIncome').textContent = totalRoundIncome.other;
        }

        // Income Calculation Functions
        function clearAllIncomeInputs() {
            // Clear terrain inputs
            const terrainInputs = ['plains', 'forest', 'hills', 'sea'];
            terrainInputs.forEach(id => {
                const input = document.getElementById(id);
                if (input) input.value = '0';
            });
            
            // Clear building inputs
            const buildingInputs = ['outposts', 'ports', 'castles'];
            buildingInputs.forEach(id => {
                const input = document.getElementById(id);
                if (input) input.value = '0';
            });
            
            // Hide the kingdom results
            const kingdomResultsDiv = document.getElementById('kingdomResults');
            if (kingdomResultsDiv) {
                kingdomResultsDiv.innerHTML = '';
            }
            
            // Hide the round income section
            const roundIncomeSection = document.getElementById('roundIncomeSection');
            if (roundIncomeSection) {
                roundIncomeSection.style.display = 'none';
            }
            
            // Update round income display
            updateRoundIncomeDisplay();
            
            showNotification('All income inputs cleared!', 'success');
        }
        
        function calculateResourceIncome() {
            // Get terrain data
            const terrainData = {
                plains: parseInt(document.getElementById('plains').value) || 0,
                forest: parseInt(document.getElementById('forest').value) || 0,
                hills: parseInt(document.getElementById('hills').value) || 0,
                sea: parseInt(document.getElementById('sea').value) || 0
            };
            
            // Get building data
            const buildingData = {
                outposts: parseInt(document.getElementById('outposts').value) || 0,
                ports: parseInt(document.getElementById('ports').value) || 0,
                castles: parseInt(document.getElementById('castles').value) || 0
            };
            
            // Calculate terrain income (example rates)
            const terrainIncome = {
                food: (terrainData.plains * 2) + (terrainData.forest * 1) + (terrainData.hills * 1),
                gold: (terrainData.plains * 1) + (terrainData.forest * 2) + (terrainData.hills * 3) + (terrainData.sea * 1),
                iron: (terrainData.hills * 2) + (terrainData.forest * 1),
                other: terrainData.sea * 1
            };
            
            // Calculate building income (example rates)
            const buildingIncome = {
                food: buildingData.outposts * 1,
                gold: (buildingData.outposts * 2) + (buildingData.ports * 3) + (buildingData.castles * 5),
                iron: (buildingData.outposts * 1) + (buildingData.castles * 2),
                other: buildingData.ports * 1
            };
            
            // Calculate round income from terrain and buildings
            const roundIncomeData = {
                food: terrainIncome.food + buildingIncome.food,
                gold: terrainIncome.gold + buildingIncome.gold,
                iron: terrainIncome.iron + buildingIncome.iron,
                other: terrainIncome.other + buildingIncome.other
            };
            
            // Total income (roundIncomeData is already terrain + building)
            const totalIncome = {
                food: roundIncomeData.food,
                gold: roundIncomeData.gold,
                iron: roundIncomeData.iron,
                other: roundIncomeData.other
            };
            
            // Show the round income section
            const roundIncomeSection = document.getElementById('roundIncomeSection');
            if (roundIncomeSection) {
                roundIncomeSection.style.display = 'block';
            }
            
            // Display results in Kingdom Management style
            displayKingdomResults(terrainIncome, buildingIncome, roundIncomeData, totalIncome);
            
            showNotification('Resource income calculated!', 'success');
        }
        
        function sendResourceIncomeToPool() {
            // Get current pool values
            const poolFood = parseInt(document.getElementById('poolFood').value) || 0;
            const poolGold = parseInt(document.getElementById('poolGold').value) || 0;
            const poolIron = parseInt(document.getElementById('poolIron').value) || 0;
            const poolOther = parseInt(document.getElementById('poolOther').value) || 0;
            
            // Get calculated income (this would need to be stored from previous calculation)
            const incomeResults = document.getElementById('incomeResults');
            if (!incomeResults || incomeResults.innerHTML === '') {
                showNotification('Please calculate resource income first!', 'error');
                return;
            }
            
            // For now, we'll use a simple calculation
            // In a real implementation, you'd store the calculated values
            const terrainData = {
                plains: parseInt(document.getElementById('plains').value) || 0,
                forest: parseInt(document.getElementById('forest').value) || 0,
                hills: parseInt(document.getElementById('hills').value) || 0,
                sea: parseInt(document.getElementById('sea').value) || 0
            };
            
            const buildingData = {
                outposts: parseInt(document.getElementById('outposts').value) || 0,
                ports: parseInt(document.getElementById('ports').value) || 0,
                castles: parseInt(document.getElementById('castles').value) || 0
            };
            
            // Calculate income
            const terrainIncome = {
                food: (terrainData.plains * 2) + (terrainData.forest * 1) + (terrainData.hills * 1),
                gold: (terrainData.plains * 1) + (terrainData.forest * 2) + (terrainData.hills * 3) + (terrainData.sea * 1),
                iron: (terrainData.hills * 2) + (terrainData.forest * 1),
                other: terrainData.sea * 1
            };
            
            const buildingIncome = {
                food: buildingData.outposts * 1,
                gold: (buildingData.outposts * 2) + (buildingData.ports * 3) + (buildingData.castles * 5),
                iron: (buildingData.outposts * 1) + (buildingData.castles * 2),
                other: buildingData.ports * 1
            };
            
            // Calculate round income from terrain and buildings
            const roundIncomeData = {
                food: terrainIncome.food + buildingIncome.food,
                gold: terrainIncome.gold + buildingIncome.gold,
                iron: terrainIncome.iron + buildingIncome.iron,
                other: terrainIncome.other + buildingIncome.other
            };
            
            const totalIncome = {
                food: roundIncomeData.food,
                gold: roundIncomeData.gold,
                iron: roundIncomeData.iron,
                other: roundIncomeData.other
            };
            
            // Add to pool
            document.getElementById('poolFood').value = poolFood + totalIncome.food;
            document.getElementById('poolGold').value = poolGold + totalIncome.gold;
            document.getElementById('poolIron').value = poolIron + totalIncome.iron;
            document.getElementById('poolOther').value = poolOther + totalIncome.other;
            
            showNotification(`Added ${totalIncome.food} food, ${totalIncome.gold} gold, ${totalIncome.iron} iron, ${totalIncome.other} other to resource pool!`, 'success');
        }
        
        function displayKingdomResults(terrainIncome, buildingIncome, roundIncome, totalIncome) {
            const resultsDiv = document.getElementById('kingdomResults');
            if (!resultsDiv) return;
            
            let html = `
                <div class="kingdom-results">
                    <h4>Kingdom Income Breakdown</h4>
                    <div class="kingdom-grid">
                        <div class="kingdom-section">
                            <h5>Terrain Sources</h5>
                            <div class="terrain-breakdown">
                                <div class="terrain-item">
                                    <strong>Plains</strong>
                                    <div class="terrain-costs">
                                        <span>üçñ ${terrainIncome.food}</span>
                                        <span>üí∞ ${terrainIncome.gold}</span>
                                    </div>
                                </div>
                                <div class="terrain-item">
                                    <strong>Forest</strong>
                                    <div class="terrain-costs">
                                        <span>üçñ ${terrainIncome.food}</span>
                                        <span>üí∞ ${terrainIncome.gold}</span>
                                        <span>‚öíÔ∏è ${terrainIncome.iron}</span>
                                    </div>
                                </div>
                                <div class="terrain-item">
                                    <strong>Hills</strong>
                                    <div class="terrain-costs">
                                        <span>üçñ ${terrainIncome.food}</span>
                                        <span>üí∞ ${terrainIncome.gold}</span>
                                        <span>‚öíÔ∏è ${terrainIncome.iron}</span>
                                    </div>
                                </div>
                                <div class="terrain-item">
                                    <strong>Sea</strong>
                                    <div class="terrain-costs">
                                        <span>üí∞ ${terrainIncome.gold}</span>
                                        <span>üì¶ ${terrainIncome.other}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="kingdom-section">
                            <h5>Building Sources</h5>
                            <div class="building-breakdown">
                                <div class="building-item">
                                    <strong>Outposts</strong>
                                    <div class="building-costs">
                                        <span>üçñ ${buildingIncome.food}</span>
                                        <span>üí∞ ${buildingIncome.gold}</span>
                                        <span>‚öíÔ∏è ${buildingIncome.iron}</span>
                                    </div>
                                </div>
                                <div class="building-item">
                                    <strong>Ports</strong>
                                    <div class="building-costs">
                                        <span>üí∞ ${buildingIncome.gold}</span>
                                        <span>üì¶ ${buildingIncome.other}</span>
                                    </div>
                                </div>
                                <div class="building-item">
                                    <strong>Castles</strong>
                                    <div class="building-costs">
                                        <span>üí∞ ${buildingIncome.gold}</span>
                                        <span>‚öíÔ∏è ${buildingIncome.iron}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="kingdom-section total-section">
                            <h5>Total Kingdom Income</h5>
                            <div class="total-breakdown">
                                <div class="total-item">üçñ Food: ${totalIncome.food}</div>
                                <div class="total-item">üí∞ Gold: ${totalIncome.gold}</div>
                                <div class="total-item">‚öíÔ∏è Iron: ${totalIncome.iron}</div>
                                <div class="total-item">üì¶ Other: ${totalIncome.other}</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            resultsDiv.innerHTML = html;
        }

        // Expense Calculation Functions
        function clearAllExpensesInputs() {
            // Clear all unit quantity inputs
            const unitQuantities = document.querySelectorAll('.unit-quantity');
            unitQuantities.forEach(quantity => {
                quantity.textContent = '0';
            });
            
            showNotification('All expense inputs cleared!', 'success');
        }
        
        function calculateUnitExpenses() {
            const faction = document.getElementById('recruitmentFaction').value;
            const units = factionUnits[faction] || [];
            
            let totalExpenses = {
                food: 0,
                gold: 0,
                iron: 0,
                other: 0
            };
            
            let unitBreakdown = [];
            
            units.forEach(unit => {
                const quantity = parseInt(document.getElementById(`quantity_${unit.name}`).textContent) || 0;
                if (quantity > 0) {
                    const unitExpense = {
                        name: unit.name,
                        quantity: quantity,
                        food: unit.food * quantity,
                        gold: unit.gold * quantity,
                        iron: unit.iron * quantity,
                        other: unit.thrall_egg_fae * quantity
                    };
                    
                    unitBreakdown.push(unitExpense);
                    
                    totalExpenses.food += unitExpense.food;
                    totalExpenses.gold += unitExpense.gold;
                    totalExpenses.iron += unitExpense.iron;
                    totalExpenses.other += unitExpense.other;
                }
            });
            
            // Display results
            displayExpenseResults(unitBreakdown, totalExpenses);
            
            showNotification('Unit expenses calculated!', 'success');
        }
        
        function takeUnitExpensesFromPool() {
            // Get current pool values
            const poolFood = parseInt(document.getElementById('poolFood').value) || 0;
            const poolGold = parseInt(document.getElementById('poolGold').value) || 0;
            const poolIron = parseInt(document.getElementById('poolIron').value) || 0;
            const poolOther = parseInt(document.getElementById('poolOther').value) || 0;
            
            // Calculate expenses
            const faction = document.getElementById('recruitmentFaction').value;
            const units = factionUnits[faction] || [];
            
            let totalExpenses = {
                food: 0,
                gold: 0,
                iron: 0,
                other: 0
            };
            
            units.forEach(unit => {
                const quantity = parseInt(document.getElementById(`quantity_${unit.name}`).textContent) || 0;
                if (quantity > 0) {
                    totalExpenses.food += unit.food * quantity;
                    totalExpenses.gold += unit.gold * quantity;
                    totalExpenses.iron += unit.iron * quantity;
                    totalExpenses.other += unit.thrall_egg_fae * quantity;
                }
            });
            
            // Check if pool has enough resources
            if (poolFood < totalExpenses.food || poolGold < totalExpenses.gold || 
                poolIron < totalExpenses.iron || poolOther < totalExpenses.other) {
                showNotification('Not enough resources in pool!', 'error');
                return;
            }
            
            // Deduct from pool
            document.getElementById('poolFood').value = poolFood - totalExpenses.food;
            document.getElementById('poolGold').value = poolGold - totalExpenses.gold;
            document.getElementById('poolIron').value = poolIron - totalExpenses.iron;
            document.getElementById('poolOther').value = poolOther - totalExpenses.other;
            
            showNotification(`Deducted ${totalExpenses.food} food, ${totalExpenses.gold} gold, ${totalExpenses.iron} iron, ${totalExpenses.other} other from resource pool!`, 'success');
        }
        
        function displayExpenseResults(unitBreakdown, totalExpenses) {
            const resultsDiv = document.getElementById('expenseResults');
            if (!resultsDiv) return;
            
            let html = `
                <div class="expense-results">
                    <h4>Unit Expenses Breakdown</h4>
                    <div class="expense-grid">
                        <div class="expense-section">
                            <h5>Unit Costs</h5>
            `;
            
            unitBreakdown.forEach(unit => {
                html += `
                    <div class="expense-item">
                        <strong>${unit.name} (${unit.quantity})</strong>
                        <div class="unit-costs">
                            <span>üçñ ${unit.food}</span>
                            <span>üí∞ ${unit.gold}</span>
                            <span>‚öíÔ∏è ${unit.iron}</span>
                            <span>üì¶ ${unit.other}</span>
                        </div>
                    </div>
                `;
            });
            
            html += `
                        </div>
                        <div class="expense-section total-section">
                            <h5>Total Expenses</h5>
                            <div class="expense-item total">üçñ Food: ${totalExpenses.food}</div>
                            <div class="expense-item total">üí∞ Gold: ${totalExpenses.gold}</div>
                            <div class="expense-item total">‚öíÔ∏è Iron: ${totalExpenses.iron}</div>
                            <div class="expense-item total">üì¶ Other: ${totalExpenses.other}</div>
                        </div>
                    </div>
                </div>
            `;
            
            resultsDiv.innerHTML = html;
        }

        // Round Counter Functions
        function increaseRound() {
            const roundInput = document.getElementById('currentRound');
            const currentRound = parseInt(roundInput.value) || 1;
            roundInput.value = currentRound + 1;
            updateRound();
        }

        function decreaseRound() {
            const roundInput = document.getElementById('currentRound');
            const currentRound = parseInt(roundInput.value) || 1;
            if (currentRound > 1) {
                roundInput.value = currentRound - 1;
                updateRound();
            }
        }

        function updateRound() {
            const roundInput = document.getElementById('currentRound');
            const currentRound = parseInt(roundInput.value) || 1;
            
            // Ensure minimum round is 1
            if (currentRound < 1) {
                roundInput.value = 1;
            }
            
            // You can add additional logic here for round-specific functionality
            console.log('Current round:', roundInput.value);
        }

        // Initialize recruitment units on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateRecruitmentUnits();
            updateRoundIncomeDisplay();
            
            // Add event listeners to terrain and building inputs to update Round Income display
            const terrainInputs = ['plains', 'forest', 'hills', 'sea'];
            const buildingInputs = ['outposts', 'ports', 'castles'];
            
            [...terrainInputs, ...buildingInputs].forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', updateRoundIncomeDisplay);
                    input.addEventListener('change', updateRoundIncomeDisplay);
                }
            });
        });
    </script>

</body>

</html> 